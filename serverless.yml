#----------------------------------------
# configuration for uploading code to the AWS cloud
# https://serverless.com/framework/docs/
#----------------------------------------
#
# edit ~/.aws/credentials with [serverless-admin] private keys
#    export AWS_PROFILE="serverless-admin"
#    export AWS_REGION=us-west-2
#    serverless deploy    # --aws-profile serverless-admin --region us-west-2
#
# The `service` block is the name of the service, as in
# https://1zqvyi3gfk.execute-api.us-east-1.amazonaws.com/dev/late-bus
#----------------------------------------

service: late-bus

# Where the service will be deployed and what it can access
provider:
  name: aws
  region: us-west-2
  runtime: nodejs6.10
  iamRoleStatements:
    - Effect: "Allow"
      Action:
        - dynamodb:*
      Resource: [
        "arn:aws:dynamodb:us-east-1:*:table/Widg*",
        "arn:aws:dynamodb:us-west-2:*:table/Bus*"
      ]

#----------------------------------------
# What code to deploy
# The 'events' block defines how to trigger the handler code
# 'handler' refers to <file name>.<function name>
#----------------------------------------
functions:

  bussy:
    handler: lateBus.helloBus
    events:
      - http:
          path: bussy-mcbus
          method: get
          cors: true


  helloWorld:
    handler: handler.helloWorld
    events:
      - http:
          path: hello-world
          method: get
          cors: true

  busRoutes:
    handler: handler.busRoutes
    events:
      - http:
          path: bus-routes
          method: get
          cors: true

  busEvent:
    handler: handler.busEvent
    events:
      - http:
          path: event
          method: get   # should be a POST
          cors: true
